diff -r --exclude=.git /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external/.idea/inspectionProfiles/Project_Default.xml /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-tcp-external/.idea/inspectionProfiles/Project_Default.xml
4,9d3
<     <inspection_tool class="MarkdownIncorrectlyNumberedListItem" enabled="false" level="WARNING" enabled_by_default="false" />
<     <inspection_tool class="SpellCheckingInspection" enabled="false" level="TYPO" enabled_by_default="false">
<       <option name="processCode" value="true" />
<       <option name="processLiterals" value="true" />
<       <option name="processComments" value="true" />
<     </inspection_tool>
Only in /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external/.idea: laravel-nginx-sock-external.iml
Only in /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-tcp-external/.idea: laravel-nginx-tcp-external.iml
Only in /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-tcp-external/.idea: misc.xml
diff -r --exclude=.git /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external/.idea/modules.xml /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-tcp-external/.idea/modules.xml
5c5
<       <module fileurl="file://$PROJECT_DIR$/.idea/laravel-nginx-sock-external.iml" filepath="$PROJECT_DIR$/.idea/laravel-nginx-sock-external.iml" />
---
>       <module fileurl="file://$PROJECT_DIR$/.idea/laravel-nginx-tcp-external.iml" filepath="$PROJECT_DIR$/.idea/laravel-nginx-tcp-external.iml" />
Only in /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external/.idea: shelf
diff -r --exclude=.git /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external/.idea/workspace.xml /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-tcp-external/.idea/workspace.xml
7c7
<     <list default="true" id="6a584582-9c8a-42e5-9088-ff075a0ac7c3" name="Changes" comment="" />
---
>     <list default="true" id="d95d48b9-2b78-4504-9611-477c07223017" name="Changes" comment="" />
17c17
<     <option name="cachedIndexableFilesCount" value="25" />
---
>     <option name="cachedIndexableFilesCount" value="22" />
20,22c20,22
<   <component name="GHAISettings">{
<   &quot;automaticallyGenerateSummary&quot;: false
< }</component>
---
>   <component name="GHAISettings"><![CDATA[{
>   "automaticallyGenerateSummary": false
> }]]></component>
31,33c31,33
<   <component name="GitHubPullRequestSearchHistory">{
<   &quot;lastFilter&quot;: {}
< }</component>
---
>   <component name="GitHubPullRequestSearchHistory"><![CDATA[{
>   "lastFilter": {}
> }]]></component>
38,45c38
<         "id": "PR_kwDORSu-Ac7FhPYk",
<         "number": 2
<       },
<       "lastSeen": 1771802395760
<     },
<     {
<       "id": {
<         "id": "PR_kwDORSu-Ac7FhOLG",
---
>         "id": "PR_kwDORWZd8s7FpeEN",
48c41
<       "lastSeen": 1771802884210
---
>       "lastSeen": 1771853056211
52,53c45,46
<         "id": "PR_kwDORSu-Ac7FheJG",
<         "number": 4
---
>         "id": "PR_kwDORWZd8s7FqR7p",
>         "number": 2
55c48
<       "lastSeen": 1771805254903
---
>       "lastSeen": 1771856445968
59c52
<         "id": "PR_kwDORSu-Ac7Fhdtu",
---
>         "id": "PR_kwDORWZd8s7FqS6i",
62,90c55
<       "lastSeen": 1771806743208
<     },
<     {
<       "id": {
<         "id": "PR_kwDORSu-Ac7FhpCr",
<         "number": 5
<       },
<       "lastSeen": 1771806823695
<     },
<     {
<       "id": {
<         "id": "PR_kwDORSu-Ac7Fhps6",
<         "number": 6
<       },
<       "lastSeen": 1771806891998
<     },
<     {
<       "id": {
<         "id": "PR_kwDORSu-Ac7FqKV6",
<         "number": 7
<       },
<       "lastSeen": 1771855986292
<     },
<     {
<       "id": {
<         "id": "PR_kwDORSu-Ac7FqOPy",
<         "number": 8
<       },
<       "lastSeen": 1771856281568
---
>       "lastSeen": 1771856509153
94,97c59,62
<   <component name="GithubPullRequestsUISettings">{
<   &quot;selectedUrlAndAccountId&quot;: {
<     &quot;url&quot;: &quot;git@github.com:skufphp/laravel-nginx-sock-external.git&quot;,
<     &quot;accountId&quot;: &quot;6a3cb611-3529-4226-b556-59a43111e969&quot;
---
>   <component name="GithubPullRequestsUISettings"><![CDATA[{
>   "selectedUrlAndAccountId": {
>     "url": "git@github.com:skufphp/laravel-nginx-tcp-external.git",
>     "accountId": "6a3cb611-3529-4226-b556-59a43111e969"
99,104c64,69
<   &quot;recentNewPullRequestHead&quot;: {
<     &quot;server&quot;: {
<       &quot;useHttp&quot;: false,
<       &quot;host&quot;: &quot;github.com&quot;,
<       &quot;port&quot;: null,
<       &quot;suffix&quot;: null
---
>   "recentNewPullRequestHead": {
>     "server": {
>       "useHttp": false,
>       "host": "github.com",
>       "port": null,
>       "suffix": null
106,107c71,72
<     &quot;owner&quot;: &quot;skufphp&quot;,
<     &quot;repository&quot;: &quot;laravel-nginx-sock-external&quot;
---
>     "owner": "skufphp",
>     "repository": "laravel-nginx-tcp-external"
109,113c74
< }</component>
<   <component name="KubernetesApiPersistence">{}</component>
<   <component name="KubernetesApiProvider">{
<   &quot;isMigrated&quot;: true
< }</component>
---
> }]]></component>
119,121d79
<   <component name="ProblemsViewState">
<     <option name="selectedTabId" value="CurrentFile" />
<   </component>
125c83
<   <component name="ProjectId" id="39p7QzVjndOTNev3drxhQdtfKHj" />
---
>   <component name="ProjectId" id="3A30OXGe0cixx9XyJp8UX6aTAYj" />
132,150c90,108
<   <component name="PropertiesComponent">{
<   &quot;keyToString&quot;: {
<     &quot;ModuleVcsDetector.initialDetectionPerformed&quot;: &quot;true&quot;,
<     &quot;RunOnceActivity.MCP Project settings loaded&quot;: &quot;true&quot;,
<     &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,
<     &quot;RunOnceActivity.TerminalTabsStorage.copyFrom.TerminalArrangementManager.252&quot;: &quot;true&quot;,
<     &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,
<     &quot;RunOnceActivity.typescript.service.memoryLimit.init&quot;: &quot;true&quot;,
<     &quot;com.intellij.ml.llm.matterhorn.ej.ui.settings.DefaultModelSelectionForGA.v1&quot;: &quot;true&quot;,
<     &quot;git-widget-placeholder&quot;: &quot;hotfix&quot;,
<     &quot;junie.onboarding.icon.badge.shown&quot;: &quot;true&quot;,
<     &quot;last_opened_file_path&quot;: &quot;/Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external&quot;,
<     &quot;node.js.detected.package.tslint&quot;: &quot;true&quot;,
<     &quot;node.js.selected.package.eslint&quot;: &quot;(autodetect)&quot;,
<     &quot;node.js.selected.package.tslint&quot;: &quot;(autodetect)&quot;,
<     &quot;nodejs_package_manager_path&quot;: &quot;npm&quot;,
<     &quot;settings.editor.selected.configurable&quot;: &quot;ml.llm.mcp&quot;,
<     &quot;to.speed.mode.migration.done&quot;: &quot;true&quot;,
<     &quot;vue.rearranger.settings.migration&quot;: &quot;true&quot;
---
>   <component name="PropertiesComponent"><![CDATA[{
>   "keyToString": {
>     "ModuleVcsDetector.initialDetectionPerformed": "true",
>     "RunOnceActivity.MCP Project settings loaded": "true",
>     "RunOnceActivity.ShowReadmeOnStart": "true",
>     "RunOnceActivity.TerminalTabsStorage.copyFrom.TerminalArrangementManager.252": "true",
>     "RunOnceActivity.git.unshallow": "true",
>     "RunOnceActivity.typescript.service.memoryLimit.init": "true",
>     "com.intellij.ml.llm.matterhorn.ej.ui.settings.DefaultModelSelectionForGA.v1": "true",
>     "git-widget-placeholder": "hotfix",
>     "junie.onboarding.icon.badge.shown": "true",
>     "last_opened_file_path": "/Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-tcp-external",
>     "node.js.detected.package.tslint": "true",
>     "node.js.selected.package.eslint": "(autodetect)",
>     "node.js.selected.package.tslint": "(autodetect)",
>     "nodejs_package_manager_path": "npm",
>     "settings.editor.selected.configurable": "preferences.fileTypes",
>     "to.speed.mode.migration.done": "true",
>     "vue.rearranger.settings.migration": "true"
152,159c110,114
<   &quot;keyToStringList&quot;: {
<     &quot;DatabaseDriversLRU&quot;: [
<       &quot;postgresql&quot;
<     ],
<     &quot;GitStage.ChangesTree.GroupingKeys&quot;: [
<       &quot;directory&quot;,
<       &quot;module&quot;,
<       &quot;repository&quot;
---
>   "keyToStringList": {
>     "GitStage.ChangesTree.GroupingKeys": [
>       "directory",
>       "module",
>       "repository"
162c117
< }</component>
---
> }]]></component>
178c133
<       <changelist id="6a584582-9c8a-42e5-9088-ff075a0ac7c3" name="Changes" comment="" />
---
>       <changelist id="d95d48b9-2b78-4504-9611-477c07223017" name="Changes" comment="" />
185,190c140,141
<       <workItem from="1771381146917" duration="635000" />
<       <workItem from="1771382813803" duration="334000" />
<       <workItem from="1771437520334" duration="8157000" />
<       <workItem from="1771724379762" duration="52000" />
<       <workItem from="1771765531257" duration="21771000" />
<       <workItem from="1771854849943" duration="1526000" />
---
>       <workItem from="1771805915327" duration="2586000" />
>       <workItem from="1771852774286" duration="3439000" />
192c143
<     <task id="LOCAL-00001" summary="Add Laravel Docker boilerplate with PHP-FPM, Nginx (Unix socket), PostgreSQL, and pgAdmin support">
---
>     <task id="LOCAL-00001" summary="Update Makefile: switch services from Unix socket to TCP">
194c145
<       <created>1771381688473</created>
---
>       <created>1771852995101</created>
198c149
<       <updated>1771381688473</updated>
---
>       <updated>1771852995101</updated>
200c151
<     <task id="LOCAL-00002" summary="Remove internal PostgreSQL references and enhance external infrastructure support in Docker boilerplate configuration.">
---
>     <task id="LOCAL-00002" summary="Switch Makefile and documentation from Unix socket to TCP for Nginx-PHP-FPM setup">
202c153
<       <created>1771458817951</created>
---
>       <created>1771856375693</created>
206c157
<       <updated>1771458817951</updated>
---
>       <updated>1771856375693</updated>
208,248c159
<     <task id="LOCAL-00003" summary="Add Redis support to Laravel Docker boilerplate, update configurations and enhance service health checks.">
<       <option name="closed" value="true" />
<       <created>1771777353294</created>
<       <option name="number" value="00003" />
<       <option name="presentableId" value="LOCAL-00003" />
<       <option name="project" value="LOCAL" />
<       <updated>1771777353294</updated>
<     </task>
<     <task id="LOCAL-00004" summary="Refactor Docker Laravel boilerplate for external PostgreSQL and Redis Cluster support; remove internal database services and update documentation and configurations.">
<       <option name="closed" value="true" />
<       <created>1771802025743</created>
<       <option name="number" value="00004" />
<       <option name="presentableId" value="LOCAL-00004" />
<       <option name="project" value="LOCAL" />
<       <updated>1771802025744</updated>
<     </task>
<     <task id="LOCAL-00005" summary="Add postgres-dev-network to Docker Compose for improved network isolation">
<       <option name="closed" value="true" />
<       <created>1771805089949</created>
<       <option name="number" value="00005" />
<       <option name="presentableId" value="LOCAL-00005" />
<       <option name="project" value="LOCAL" />
<       <updated>1771805089949</updated>
<     </task>
<     <task id="LOCAL-00006" summary="Update README and SETUP.md with detailed instructions for external PostgreSQL setup, including db/user creation, .env configuration, and troubleshooting steps.">
<       <option name="closed" value="true" />
<       <created>1771806723312</created>
<       <option name="number" value="00006" />
<       <option name="presentableId" value="LOCAL-00006" />
<       <option name="project" value="LOCAL" />
<       <updated>1771806723312</updated>
<     </task>
<     <task id="LOCAL-00007" summary="Expand Makefile with additional phony targets for improved task organization and management">
<       <option name="closed" value="true" />
<       <created>1771855881125</created>
<       <option name="number" value="00007" />
<       <option name="presentableId" value="LOCAL-00007" />
<       <option name="project" value="LOCAL" />
<       <updated>1771855881125</updated>
<     </task>
<     <option name="localTasksCounter" value="8" />
---
>     <option name="localTasksCounter" value="3" />
254,264d164
<   <component name="Vcs.Log.Tabs.Properties">
<     <option name="TAB_STATES">
<       <map>
<         <entry key="MAIN">
<           <value>
<             <State />
<           </value>
<         </entry>
<       </map>
<     </option>
<   </component>
266,277c166,168
<     <MESSAGE value="Add Laravel Docker boilerplate with PHP-FPM, Nginx (Unix socket), PostgreSQL, and pgAdmin support" />
<     <MESSAGE value="Remove internal PostgreSQL references and enhance external infrastructure support in Docker boilerplate configuration." />
<     <MESSAGE value="Add Redis support to Laravel Docker boilerplate, update configurations and enhance service health checks." />
<     <MESSAGE value="Refactor Laravel Docker boilerplate to support external PostgreSQL and Redis cluster, remove internal infrastructure references, and streamline Makefile and configuration files." />
<     <MESSAGE value="Remove internal databases and Redis from Docker configuration, enhance external infrastructure support, and update documentation." />
<     <MESSAGE value="Remove internal PostgreSQL, Redis, and pgAdmin services; refactor Docker boilerplate for external infrastructure support with updated configurations, streamlined Makefile, and enhanced documentation." />
<     <MESSAGE value="Refactor Docker Laravel boilerplate for external PostgreSQL and Redis Cluster support; remove internal database services and update documentation and configurations." />
<     <MESSAGE value="Add postgres-dev-network to Docker Compose for improved network isolation" />
<     <MESSAGE value="Update README and SETUP.md to clarify external PostgreSQL setup process and `.env` configuration" />
<     <MESSAGE value="Update README and SETUP.md with detailed instructions for external PostgreSQL setup, including db/user creation, .env configuration, and troubleshooting steps." />
<     <MESSAGE value="Expand Makefile with additional phony targets for improved task organization and management" />
<     <option name="LAST_COMMIT_MESSAGE" value="Expand Makefile with additional phony targets for improved task organization and management" />
---
>     <MESSAGE value="Update Makefile: switch services from Unix socket to TCP" />
>     <MESSAGE value="Switch Makefile and documentation from Unix socket to TCP for Nginx-PHP-FPM setup" />
>     <option name="LAST_COMMIT_MESSAGE" value="Switch Makefile and documentation from Unix socket to TCP for Nginx-PHP-FPM setup" />
Only in /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external: .output.txt
diff -r --exclude=.git /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external/Makefile /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-tcp-external/Makefile
2c2
< # Laravel PHP-FPM Nginx Socket (Boilerplate)
---
> # Laravel PHP-FPM TCP (Boilerplate)
32,34c32,34
< PHP_SERVICE=laravel-php-nginx-socket
< NGINX_SERVICE=laravel-nginx-socket
< NODE_SERVICE=laravel-node-nginx-socket
---
> PHP_SERVICE=laravel-php-nginx-tcp
> NGINX_SERVICE=laravel-nginx-tcp
> NODE_SERVICE=laravel-node-nginx-tcp
37c37
< 	@echo "$(YELLOW)Laravel Docker Boilerplate (Unix Socket)$(NC)"
---
> 	@echo "$(YELLOW)Laravel Docker Boilerplate (TCP)$(NC)"
130c130
< npm-build: ## Собрать фронтенд (внутри PHP контейнера для prod-like билда или dev)
---
> npm-build: ## Собрать фронтенд (внутри Node контейнера)
diff -r --exclude=.git /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external/README.md /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-tcp-external/README.md
1c1
< # Laravel Boilerplate (PHP-FPM + Nginx Unix Socket + External PostgreSQL + External Redis Cluster)
---
> # Laravel Boilerplate (PHP-FPM + Nginx TCP + External PostgreSQL + External Redis Cluster)
7c7
< *   **Производительность:** связь между Nginx и PHP-FPM настроена через **Unix Socket**.
---
> *   **Производительность:** связь между Nginx и PHP-FPM настроена через **TCP (порт 9000)**.
diff -r --exclude=.git /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external/SETUP.md /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-tcp-external/SETUP.md
1c1
< # SETUP — Laravel Boilerplate (PHP-FPM + Nginx Unix Socket + External PostgreSQL + External Redis Cluster)
---
> # SETUP — Laravel Boilerplate (PHP-FPM + Nginx TCP + External PostgreSQL + External Redis Cluster)
4a5
> - **PHP-FPM и Nginx взаимодействуют по TCP** (порт 9000);
17,18c18,19
<   - PostgreSQL: `host:port`, база, пользователь, пароль
<   - Redis Cluster: список нод `host:port,host:port,...`, пароль/ACL (если есть), TLS (если требуется)
---
>     - PostgreSQL: `host:port`, база, пользователь, пароль
>     - Redis Cluster: список нод `host:port,host:port,...`, пароль/ACL (если есть), TLS (если требуется)
230,232c231,233
<   1) pull новых образов
<   2) `up -d` приложения
<   3) `run --rm migrate`
---
>     1) pull новых образов
>     2) `up -d` приложения
>     3) `run --rm migrate`
Only in /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external: diff_output.txt
diff -r --exclude=.git /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external/docker/nginx/conf.d/laravel.conf /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-tcp-external/docker/nginx/conf.d/laravel.conf
2c2
< # Laravel Nginx Socket — конфигурация виртуального хоста для Laravel
---
> # Laravel Nginx TCP — конфигурация виртуального хоста для Laravel
6c6
< # - Проксирует запросы к PHP-файлам в PHP-FPM через FastCGI по Unix-сокету
---
> # - Проксирует запросы к PHP-файлам в PHP-FPM через FastCGI по TCP (порт 9000)
12c12
< # - PHP-FPM слушает Unix-сокет /var/run/php/php-fpm.sock (общий Volume с Nginx)
---
> # - PHP-FPM слушает TCP-порт 9000 внутри Docker-сети (имя сервиса: laravel-php-nginx-tcp)
52c52
<     # Обработка PHP-скриптов через FastCGI (Unix-сокет)
---
>     # Обработка PHP-скриптов через FastCGI (TCP-соединение с PHP-FPM)
63,64c63,64
<         # Адрес PHP-FPM: путь к Unix-сокету
<         fastcgi_pass   unix:/var/run/php/php-fpm.sock;
---
>         # Адрес PHP-FPM: имя сервиса из docker-compose.yml и порт 9000
>         fastcgi_pass   laravel-php-nginx-tcp:9000;
diff -r --exclude=.git /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external/docker/nginx.Dockerfile /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-tcp-external/docker/nginx.Dockerfile
7,11d6
< # Добавляем пользователя nginx в группу www-data
< # Это необходимо для того, чтобы Nginx мог читать/писать в UNIX-сокет,
< # владельцем которого является пользователь www-data (из PHP-FPM)
< RUN addgroup nginx www-data
< 
diff -r --exclude=.git /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external/docker/php/www.conf /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-tcp-external/docker/php/www.conf
4,5c4,6
< ;   - Работа через UNIX-сокет для максимальной производительности
< ;   - Оптимизировано для Docker и Alpine Linux
---
> ;   - Работа по TCP-порту внутри контейнерной сети (удобно для связки с Nginx в Docker)
> ;   - Прокидывание переменных окружения внутрь PHP (для .env / Xdebug / конфигов)
> ;   - Встроенный healthcheck через ping endpoint (/ping -> "pong")
8c9,10
< ; Название пула процессов (используется в логах/статусе и при наличии нескольких пулов)
---
> ; Название пула процессов.
> ; Используется в логах/статусе, а также полезно при наличии нескольких пулов.
11,13c13,18
< ; Адрес прослушивания.
< ; UNIX-сокет быстрее TCP внутри одного хоста/контейнерной сети (нет накладных расходов на сеть).
< listen = /var/run/php/php-fpm.sock
---
> ; Адрес, на котором FPM принимает FastCGI-запросы.
> ; Здесь выбран TCP-порт 9000 (частый вариант для Docker):
> ; - проще подключать Nginx по сети (container-to-container)
> ; - не нужно шарить файловую систему под UNIX-сокет
> ; Минус: TCP чуть «тяжелее», чем UNIX-сокет, но в одной docker-сети обычно это не критично.
> listen = 9000
16c21
< ; Важно: должны совпадать с моделью прав на файлы проекта (storage/, cache/ и т.п.)
---
> ; Важно: права на storage/, bootstrap/cache/ и прочие writable-директории должны это учитывать.
20,26d24
< ; Права доступа к сокету:
< ; - владелец/группа сокета выставляются при старте php-fpm
< ; - Nginx должен иметь доступ к сокету (обычно через ту же группу или пользователя)
< listen.owner = www-data
< listen.group = www-data
< listen.mode = 0660
< 
37,39c35,37
< ; Режим управления процессами:
< ; dynamic — php-fpm сам поддерживает нужное число воркеров между min/max spare.
< ; Подходит для большинства приложений и умеренной нагрузки.
---
> ; Режим управления воркерами:
> ; dynamic — FPM сам поддерживает нужное число процессов между min/max spare.
> ; Хороший «дефолт» для большинства веб-приложений со скачкообразной нагрузкой.
42,43c40,41
< ; Верхний предел воркеров (процессов), обслуживающих запросы одновременно.
< ; Главный лимит по памяти/конкурентности: каждый воркер потребляет RAM.
---
> ; Максимальное число воркеров (детей), которые могут обслуживать запросы одновременно.
> ; Это главный лимит по конкурентности и памяти: каждый воркер = отдельный процесс = отдельный расход RAM.
46,47c44,45
< ; Количество воркеров, создаваемых при старте пула.
< ; Слишком высокое значение может зря расходовать память, слишком низкое — добавит задержку на «прогрев».
---
> ; Сколько воркеров поднять сразу при старте пула.
> ; Слишком много — лишняя память «впустую», слишком мало — задержки на разогрев под нагрузкой.
50,51c48,49
< ; Минимальное количество «ожидающих» (idle) воркеров.
< ; Если idle меньше этого значения — php-fpm будет форкать новые процессы.
---
> ; Минимум «свободных» (idle) воркеров.
> ; Если свободных меньше — FPM будет форкать новые процессы.
54,56c52,54
< ; Максимальное количество «ожидающих» (idle) воркеров.
< ; Если idle больше — php-fpm будет завершать лишние воркеры, освобождая память.
< pm.max_spare_servers = 3
---
> ; Максимум «свободных» (idle) воркеров.
> ; Если свободных больше — FPM будет завершать лишние процессы, освобождая память.
> pm.max_spare_servers = 4
58,59c56,58
< ; Ограничение числа запросов на один воркер до перезапуска.
< ; Полезно против утечек памяти/фрагментации: воркер «освежается» после N запросов.
---
> ; Ограничение количества запросов на один воркер до принудительного перезапуска.
> ; Полезно против редких утечек/фрагментации: воркер «освежается» после N запросов.
> ; Слишком маленькое значение увеличит накладные расходы на частые перезапуски.
66,67c65,66
< ; Перехватывать stdout/stderr воркеров и отправлять в лог php-fpm.
< ; В Docker это удобно: сообщения попадают в логи контейнера и видны через `docker logs`.
---
> ; Перехватывать stdout/stderr воркеров и направлять в лог php-fpm.
> ; В контейнерах это особенно удобно: сообщения окажутся в stdout/stderr контейнера и видны через docker logs.
70,71c69,70
< ; Таймаут для «медленных» запросов.
< ; Если запрос выполняется дольше указанного — будет записан slowlog с backtrace (где именно тормозит).
---
> ; Таймаут «медленного» запроса.
> ; Если выполнение дольше указанного — FPM запишет slowlog (с backtrace), чтобы понять, где тормозит код.
75c74,76
< ; /proc/self/fd/2 = stderr текущего процесса (идеально для контейнеров: попадёт в агрегированные логи).
---
> ; /proc/self/fd/2 = stderr текущего процесса:
> ; - идеально для Docker/оркестраторов (логи собираются централизованно)
> ; - не нужно заводить отдельный файл и думать о ротации внутри контейнера
78,79c79,81
< ; Жёсткий таймаут выполнения запроса (kill воркера, если запрос не завершился).
< ; Это «последний рубеж», чтобы зависшие запросы не удерживали воркеры бесконечно.
---
> ; Жёсткий таймаут выполнения запроса.
> ; Если запрос не завершился вовремя — FPM завершит воркер.
> ; Это «предохранитель», чтобы зависшие запросы не съедали все воркеры навсегда.
86,87c88,90
< ; Встроенный ping endpoint FPM (для healthcheck).
< ; Обычно дергается внутренними проверками (как у тебя через cgi-fcgi) и НЕ должен быть доступен из интернета.
---
> ; Встроенный ping endpoint FPM.
> ; Используется для внутренних проверок работоспособности (например, cgi-fcgi в healthcheck контейнера).
> ; Важно: этот endpoint не должен быть доступен напрямую из интернета.
90c93
< ; Тело ответа для ping (что именно вернётся при успешном ответе).
---
> ; Тело ответа для ping (что вернёт FPM при успешном ответе).
98,99c101,102
< ; Защищает от случайной обработки «не-PHP» файлов через fastcgi.
< security.limit_extensions = .php
---
> ; Защищает от случайной обработки «не-PHP» файлов через FastCGI при неверной настройке веб-сервера.
> security.limit_extensions = .php
\ No newline at end of file
diff -r --exclude=.git /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external/docker/php.Dockerfile /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-tcp-external/docker/php.Dockerfile
2c2
< # Многоэтапный образ PHP-FPM (Unix Socket) — PHP 8.5 Alpine (Laravel)
---
> # Multi-stage PHP-FPM Image (TCP) — PHP 8.5 Alpine (Laravel)
23c23
< # Базовая среда PHP (без node) — используется для разработки и как основа для продакшена
---
> # PHP base runtime (no node) — used for dev target and as base for production
27c27
< # 1) Зависимости времени выполнения + Зависимости для сборки (удалим после компиляции)
---
> # 1) Runtime deps + Build deps (build deps удалим после сборки)
37c37
< # 2) PHP расширения
---
> # 2) PHP extensions
51c51
< # 3) PIE (PHP Installer for Extensions) + Xdebug (только для разработки)
---
> # 3) PIE (PHP Installer for Extensions) + Xdebug (dev only)
61c61
< # 4) Очистка временных файлов
---
> # 4) Cleanup
66c66
< # 5) Конфигурация PHP-FPM (unix socket) + php.ini
---
> # 5) PHP-FPM config (TCP port 9000) + php.ini
77c77
< # 6) Установка Composer
---
> # 6) Composer
82a83,85
> # 7) Open PHP-FPM port
> EXPOSE 9000
> 
87c90
< # Production образ: код + собранные ассеты (идеально для деплоя)
---
> # Production target: code + built assets baked in (immutable)
diff -r --exclude=.git /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external/docker-compose.dev.yml /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-tcp-external/docker-compose.dev.yml
2,3c2
<   # Настройки PHP для разработки (монтирование кода)
<   laravel-php-nginx-socket:
---
>   laravel-php-nginx-tcp:
6d4
<       - unix-socket:/var/run/php
8,9c6
<   # Настройки Nginx для разработки
<   laravel-nginx-socket:
---
>   laravel-nginx-tcp:
14c11
<       - unix-socket:/var/run/php
---
>       - ./docker/nginx/conf.d/laravel.conf:/etc/nginx/conf.d/default.conf:ro
16c13
<       - laravel-node-nginx-socket
---
>       - laravel-node-nginx-tcp
19c16
<   laravel-node-nginx-socket:
---
>   laravel-node-nginx-tcp:
21c18
<     container_name: laravel-node-nginx-socket
---
>     container_name: laravel-node-nginx-tcp
28d24
<         # Установка зависимостей, если они отсутствуют
35d30
<         # Запуск Vite в режиме разработки
41c36
<       - laravel-nginx-socket-network
---
>       - laravel-nginx-tcp-network
diff -r --exclude=.git /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external/docker-compose.prod.yml /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-tcp-external/docker-compose.prod.yml
3c3
<   laravel-php-nginx-socket:
---
>   laravel-php-nginx-tcp:
10c10
<   laravel-nginx-socket:
---
>   laravel-nginx-tcp:
25c25
<       - laravel-nginx-socket-network
\ No newline at end of file
---
>       - laravel-nginx-tcp-network
\ No newline at end of file
diff -r --exclude=.git /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-sock-external/docker-compose.yml /Users/vlavlamat/WorkSpace/php/php-stacks/laravel-nginx-tcp-external/docker-compose.yml
2,3c2,3
<   # Основной контейнер Laravel PHP-FPM
<   laravel-php-nginx-socket:
---
>   # Laravel PHP-FPM
>   laravel-php-nginx-tcp:
8c8
<     container_name: laravel-php-nginx-socket
---
>     container_name: laravel-php-nginx-tcp
15,17d14
<     volumes:
<       # Общий том для UNIX-сокета (связь с Nginx)
<       - unix-socket:/var/run/php
19c16
<       - laravel-nginx-socket-network
---
>       - laravel-nginx-tcp-network
22d18
<       # Проверка доступности FPM через сокет
26c22
<           "SCRIPT_NAME=/ping SCRIPT_FILENAME=/ping REQUEST_METHOD=GET cgi-fcgi -bind -connect /var/run/php/php-fpm.sock | grep -q 'pong'"
---
>           "SCRIPT_NAME=/ping SCRIPT_FILENAME=/ping REQUEST_METHOD=GET cgi-fcgi -bind -connect 127.0.0.1:9000 | grep -q 'pong'"
33,34c29,30
<   # Веб-сервер Nginx (Proxy)
<   laravel-nginx-socket:
---
>   # Веб-сервер Nginx
>   laravel-nginx-tcp:
38c34
<     container_name: laravel-nginx-socket
---
>     container_name: laravel-nginx-tcp
40,42d35
<     volumes:
<       # Подключаем тот же том с сокетом
<       - unix-socket:/var/run/php
44c37
<       - laravel-nginx-socket-network
---
>       - laravel-nginx-tcp-network
52c45
<       laravel-php-nginx-socket:
---
>       laravel-php-nginx-tcp:
55,57d47
< volumes:
<   unix-socket:
< 
59c49
<   laravel-nginx-socket-network:
---
>   laravel-nginx-tcp-network:
